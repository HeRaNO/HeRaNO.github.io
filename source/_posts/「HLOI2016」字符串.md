---
title: 「HLOI2016」字符串
categories: 'OI/ICPC'
date: 2017-02-18 15:55:39
tags:
	- HLOI
	- 线段树
toc: true
description: HLOI2016 Day1 T1
---

## 题目描述
我们知道，哈希 (*hash*) 算法被广泛应用于字符串处理领域之中。现有如下哈希函数：

$$f(s,l,r)=\prod_{i=l}^r \text{ord}(s_i) \bmod p$$

公式中，$\text{ord}$ 代表的是字符的 ASCII 码，$\bmod$ 代表的是求余操作，$\prod$ 则是求积操作，意为求 $l$ 到 $r$ 之间所有字符的 ASCII 码的积。

现在给定一个长度为 $N$ 的字符串，并给出 $p$，之后会有若干组询问，每次询问这个字符串相对于那个区间的子串的哈希值。

## 输入
输入包括若干行，其中第一行是一个字符串，数据保证其中只会出现小写英文字母；

第二行是一个整数 $p$；

第三行是一个整数 $m$，表示询问的次数；

接下来的 $m$ 行，每行有两个整数 $l,r$，表示询问从第 $l$ 位到第 $r$ 位的哈希值。

## 输出
输出包括 $m$ 行，依次给出输入文件中相应的询问对应的答案。

## 样例输入
```
efqzvcowdormnslhjzznubn
56
4
17 18
7 20
14 16
15 23
```

## 样例输出
```
52
0
40
0
```

## 数据范围及约定
对于 $30\%$ 的数据，$1\le N\le 100,1\le m\le 10$；

对于 $70\%$ 的数据，$1\le N\le 10^5,1\le m\le 10^4$；

对于 $100\%$ 的数据，$1\le N\le 10^5,1\le m\le 10^5,1\le l\le r\le n$。

## 时间与空间限制
时间限制：$1000\text{ms}$，空间限制：$128\text{MB}$。

## 题解
黑历史题，只有查询的线段树……

只有查询？先求前缀积，再求个逆元，搞一搞就好了……

但是并不知道 $p$ 有多大，题中也没说，~~题解说可以写~~也是一种优化方法吧。

时间复杂度为 $\mathcal{O}(n+T\log n)$，空间复杂度为 $\mathcal{O}(n)$。

代码见[这里](https://github.com/HeRaNO/OI-ICPC-Codes/blob/master/HSAHRBNUOJ/P38xx/P3871.cpp)。
